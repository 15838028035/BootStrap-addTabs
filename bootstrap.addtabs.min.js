/**
 * Website: http://git.oschina.net/hbbcs/bootStrap-addTabs
 *
 * Version : 1.5
 *
 * Created by joe on 2016-2-15.
 */
$.fn.addtabs=function(a){Addtabs.options=$.extend({content:"",close:true,monitor:"body",iframeUse:true,iframeHeight:$(document).height()-107,contextmenu:true,obj:$(this),local:{"refreshLabel":"刷新此标签","closeThisLabel":"关闭此标签","closeOtherLabel":"关闭其他标签","closeLeftLabel":"关闭左侧标签","closeRightLabel":"关闭右侧标签"},callback:function(){}},a||{});$(Addtabs.options.monitor).on("click","[data-addtab]",function(){Addtabs.add({id:$(this).data("addtab"),title:$(this).data("title")?$(this).data("title"):$(this).html(),content:Addtabs.options.content?Addtabs.options.content:$(this).data("content"),url:$(this).data("url"),ajax:$(this).data("ajax")?true:false})});Addtabs.options.obj.on("click",".close-tab",function(){var b=$(this).prev("a").attr("aria-controls");Addtabs.close(b)});if(Addtabs.options.contextmenu){Addtabs.options.obj.on("contextmenu","li[role=presentation]",function(){var b=$(this).children("a").attr("aria-controls");Addtabs.pop(b,$(this));return false});Addtabs.options.obj.on("click","ul.rightMenu a[data-right=refresh]",function(){var c=$(this).parent("ul").attr("aria-controls").substring(4);var b=$(this).parent("ul").attr("aria-url");Addtabs.add({"id":c,"url":b,"refresh":true})});Addtabs.options.obj.on("click","ul.rightMenu a[data-right=remove]",function(){var b=$(this).parent("ul").attr("aria-controls");if(b.substring(0,4)!="tab_"){return}Addtabs.close(b);Addtabs.drop()});Addtabs.options.obj.on("click","ul.rightMenu a[data-right=remove-circle]",function(){var b=$(this).parent("ul").attr("aria-controls");Addtabs.options.obj.children("ul.nav").find("li").each(function(){var c=$(this).attr("id");if(c&&c!="tab_"+b){Addtabs.close($(this).children("a").attr("aria-controls"))}});Addtabs.drop()});Addtabs.options.obj.on("click","ul.rightMenu a[data-right=remove-left]",function(){var b=$(this).parent("ul").attr("aria-controls");$("#tab_"+b).prevUntil().each(function(){var c=$(this).attr("id");if(c&&c!="tab_"+b){Addtabs.close($(this).children("a").attr("aria-controls"))}});Addtabs.drop()});Addtabs.options.obj.on("click","ul.rightMenu a[data-right=remove-right]",function(){var b=$(this).parent("ul").attr("aria-controls");$("#tab_"+b).nextUntil().each(function(){var c=$(this).attr("id");if(c&&c!="tab_"+b){Addtabs.close($(this).children("a").attr("aria-controls"))}});Addtabs.drop()})}Addtabs.options.obj.on("mouseover",'li[role = "presentation"]',function(){$(this).find(".close-tab").show()});Addtabs.options.obj.on("mouseleave",'li[role = "presentation"]',function(){$(this).find(".close-tab").hide()});$(window).resize(function(){Addtabs.options.obj.find("iframe").attr("height",Addtabs.options.iframeHeight);Addtabs.drop()})};window.Addtabs={options:{},add:function(b){var d="tab_"+b.id;Addtabs.options.obj.find('li[role = "presentation"].active').removeClass("active");Addtabs.options.obj.find('div[role = "tabpanel"].active').removeClass("active");if(!$("#"+d).length){var c=$("<li>",{"role":"presentation","id":"tab_"+d,"aria-url":b.url,"draggable":true}).append($("<a>",{"href":"#"+d,"aria-controls":d,"role":"tab","data-toggle":"tab"}).html(b.title));if(Addtabs.options.close){c.append($("<i>",{"class":"close-tab glyphicon glyphicon-remove"}))}var a=$("<div>",{"class":"tab-pane","id":d,"role":"tabpanel"});Addtabs.options.obj.children(".nav-tabs").append(c);Addtabs.options.obj.children(".tab-content").append(a)}else{if(!b.refresh){$("#tab_"+d).addClass("active");$("#"+d).addClass("active");Addtabs.drop();return}else{var a=$("#"+d);a.html("")}}if(b.content){a.append(b.content)}else{if(Addtabs.options.iframeUse&&!b.ajax){a.append($("<iframe>",{"class":"iframeClass","height":Addtabs.options.iframeHeight,"frameborder":"no","border":"0","src":b.url}))}else{$.get(b.url,function(e){a.append(e)})}}$("#tab_"+d).addClass("active");$("#"+d).addClass("active");Addtabs.drop()},pop:function(g,f){$("body").find("#popMenu").remove();var c=f.attr("id")?'<a href="javascript:void(0);" class="list-group-item" data-right="refresh"><i class="glyphicon glyphicon-refresh"></i> '+Addtabs.options.local.refreshLabel+"</a>"+'<a href="javascript:void(0);" class="list-group-item" data-right="remove"><i class="glyphicon glyphicon-remove"></i> '+Addtabs.options.local.closeThisLabel+"</a>":"";var d=f.prev("li").attr("id")?'<a href="javascript:void(0);" class="list-group-item" data-right="remove-left"><i class="glyphicon glyphicon-chevron-left"></i> '+Addtabs.options.local.closeLeftLabel+"</a>":"";var b=f.next("li").attr("id")?'<a href="javascript:void(0);" class="list-group-item" data-right="remove-right"><i class="glyphicon glyphicon-chevron-right"></i> '+Addtabs.options.local.closeRightLabel+"</a>":"";var a=$("<ul>",{"aria-controls":g,"class":"rightMenu list-group",id:"popMenu","aria-url":f.attr("aria-url")}).append(c+'<a href="javascript:void(0);" class="list-group-item" data-right="remove-circle"><i class="glyphicon glyphicon-remove-circle"></i> '+Addtabs.options.local.closeOtherLabel+"</a>"+d+b);a.css({"top":f[0].offsetTop+10,"left":f[0].offsetLeft+60});a.appendTo(Addtabs.options.obj).fadeIn("slow");a.mouseleave(function(){$(this).fadeOut("slow")});$("body").click(function(){a.fadeOut("slow")})},close:function(a){if(Addtabs.options.obj.find("li.active").attr("id")==="tab_"+a){$("#tab_"+a).prev().addClass("active");$("#"+a).prev().addClass("active")}$("#tab_"+a).remove();$("#"+a).remove();Addtabs.drop();Addtabs.options.callback()},closeAll:function(){$.each(Addtabs.options.obj.find("li[id]"),function(){var b=$(this).children("a").attr("aria-controls");$("#tab_"+b).remove();$("#"+b).remove()});Addtabs.options.obj.find('li[role = "presentation"]').first().addClass("active");var a=Addtabs.options.obj.find('li[role = "presentation"]').first().children("a").attr("aria-controls");$("#"+a).addClass("active");Addtabs.drop()},drop:function(){element=Addtabs.options.obj.find(".nav-tabs");var b=$("<li>",{"class":"dropdown pull-right hide tabdrop tab-drop"}).append($("<a>",{"class":"dropdown-toggle","data-toggle":"dropdown","href":"#"}).append($("<i>",{"class":"glyphicon glyphicon-align-justify"})).append($("<b>",{"class":"caret"}))).append($("<ul>",{"class":"dropdown-menu"}));if(!$(".tabdrop").html()){b.prependTo(element)}else{b=element.find(".tabdrop")}if(element.parent().is(".tabs-below")){b.addClass("dropup")}var a=0;element.append(b.find("li")).find(">li").not(".tabdrop").each(function(){if(this.offsetTop>0||element.width()-$(this).position().left-$(this).width()<83){b.find("ul").prepend($(this));a++}});if(a>0){b.removeClass("hide");if(b.find(".active").length==1){b.addClass("active")}else{b.removeClass("active")}}else{b.addClass("hide")}}};